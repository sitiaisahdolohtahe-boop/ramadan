<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ramadan Thailand</title>
<style>
body{
    margin:0;
    background:#05060d;
    color:white;
    font-family:sans-serif;
    overflow:hidden;
}
.container{
    position:absolute;
    top:30px;
    left:40px;
}
#countdown{
    position:absolute;
    bottom:120px;
    width:100%;
    text-align:center;
    font-size:50px;
}
input,button{
    padding:6px 10px;
    border:none;
    border-radius:5px;
}
button{cursor:pointer;}
</style>
</head>
<body>

<div class="container">
    <div id="location">Loading...</div><br>

    <input type="text" id="cityInput" placeholder="Enter city (Thailand)">
    <button onclick="searchCity()">Search</button>

    <div id="iftar"></div>
    <div id="suhoor"></div>
</div>

<div id="countdown"></div>

<script>

let maghribTime=null;
let fajrTime=null;
let currentMode="iftar";

/* ===== ดึงเวลาจากพิกัดจริง ===== */
async function fetchTimesByCity(city){
    try{
        // แปลงชื่อเมือง → พิกัด
        let geo = await fetch(
            `https://api.aladhan.com/v1/geocode?address=${city},Thailand`
        );
        let geoData = await geo.json();

        if(!geoData.data || geoData.data.length === 0){
            alert("City not found ❌");
            return;
        }

        let lat = geoData.data[0].latitude;
        let lon = geoData.data[0].longitude;

        // ดึงเวลาละหมาด
        let response = await fetch(
`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lon}&method=3&school=0`
        );

        let data = await response.json();

        maghribTime = data.data.timings.Maghrib.split(" ")[0];
        fajrTime    = data.data.timings.Fajr.split(" ")[0];

        document.getElementById("iftar").innerText =
            "Iftar (Maghrib): " + maghribTime;

        document.getElementById("suhoor").innerText =
            "Subuh (Fajr): " + fajrTime;

        document.getElementById("location").innerText =
            city + ", Thailand";

    }catch(error){
        alert("Error fetching data");
    }
}

/* ===== Search ===== */
function searchCity(){
    let city=document.getElementById("cityInput").value.trim();
    if(city){
        fetchTimesByCity(city);
        document.getElementById("cityInput").value="";
    }
}

document.getElementById("cityInput")
.addEventListener("keydown",function(e){
    if(e.key==="Enter") searchCity();
});

/* ===== Countdown Logic ===== */
function getTarget(){
    let now=new Date();
    let target=new Date();

    if(currentMode==="iftar"){
        let [h,m]=maghribTime.split(":");
        target.setHours(h,m,0);

        if(now>=target){
            currentMode="suhoor";
            return getTarget();
        }
    }else{
        let [h,m]=fajrTime.split(":");
        target.setHours(h,m,0);

        if(now>=target){
            currentMode="iftar";
            return getTarget();
        }
    }

    if(now>target) target.setDate(target.getDate()+1);
    return target;
}

function updateCountdown(){
    if(!maghribTime||!fajrTime) return;

    let now=new Date();
    let target=getTarget();
    let diff=target-now;

    let h=Math.floor(diff/1000/60/60);
    let m=Math.floor(diff/1000/60%60);
    let s=Math.floor(diff/1000%60);

    document.getElementById("countdown").innerText=
        h.toString().padStart(2,"0")+":"+
        m.toString().padStart(2,"0")+":"+
        s.toString().padStart(2,"0");
}

setInterval(updateCountdown,1000);

/* ===== Default ===== */
fetchTimesByCity("Hat Yai");

</script>
</body>
</html>

